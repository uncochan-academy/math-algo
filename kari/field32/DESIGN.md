# field32 電卓GUI 設計方針

## 概要

GF(2^32)有限体演算ライブラリ用のGUI電卓アプリケーション
- フレームワーク: egui
- 言語: 日本語
- 対象演算: 加算（XOR）、乗算、逆元計算

## アーキテクチャ設計

### 1. プロジェクト構成

```
field32/
├── Cargo.toml (eframe = "0.29", egui = "0.29" を追加)
└── src/
    ├── field32.rs (既存 + add関数を追加)
    ├── lib.rs (新規 - field32モジュールを公開)
    ├── gui.rs (新規 - GUI実装)
    └── main.rs (更新 - GUIアプリ起動)
```

### 2. データ構造設計

```rust
struct CalculatorApp {
    // 入力状態
    input_a: String,      // 1つ目の数値入力
    input_b: String,      // 2つ目の数値入力（演算用）
    inverse_input: String, // 逆元計算用入力

    // 結果状態
    result: Option<u32>,
    error_message: String,

    // 多項式表示
    poly_a: String,       // input_aの多項式表記
    poly_b: String,       // input_bの多項式表記
    poly_result: String,  // 結果の多項式表記
}
```

## 機能設計

### 3. field32.rsへの追加機能

既存のライブラリに以下を追加：

```rust
/// GF(2^32)での加算（XOR演算）
pub fn add(a: MyNumber, b: MyNumber) -> MyNumber {
    MyNumber {
        value: a.value ^ b.value
    }
}
```

### 4. 実装する演算

| 演算 | 関数 | 説明 |
|------|------|------|
| 加算 | `add(a, b)` | a.value ^ b.value（XOR） |
| 乗算 | `a * b` | 既存のMul trait |
| 逆元 | `inverse(a)` | 既存の関数 |

## UI設計

### 5. レイアウト構成

3つのセクションに分割：

#### セクション1: 基本演算（加算・乗算）
- 入力A (テキストボックス) → リアルタイム多項式表示
- 入力B (テキストボックス) → リアルタイム多項式表示
- 横並びで「加算 (A + B)」「乗算 (A × B)」ボタン
- 結果（10進数 + 多項式表記）

#### セクション2: 逆元計算
- 入力 (テキストボックス) → リアルタイム多項式表示
- 「逆元を計算」ボタン
- 結果（10進数 + 多項式表記）
- 検証表示（a × a⁻¹ = 1）

#### セクション3: 説明エリア
- GF(2^32)についての簡単な説明
- 加算はXOR演算であることの説明
- 使用している既約多項式の表示

### 6. UI配置例

```
┌─────────────────────────────────────┐
│ 有限体GF(2³²)での演算               │
├─────────────────────────────────────┤
│ 入力A: [        ] → x³¹ + x² + 1    │
│ 入力B: [        ] → x + 1           │
│ [加算 (A + B)] [乗算 (A × B)]       │
│ 結果: 12345 → x¹⁵ + x³ + ...        │
├─────────────────────────────────────┤
│ 逆元計算                            │
├─────────────────────────────────────┤
│ 入力: [        ] → x² + 1           │
│ [逆元を計算]                        │
│ 逆元: 67890 → x²⁰ + x⁵ + ...       │
│ 検証: 5 × 67890 = 1 ✓              │
├─────────────────────────────────────┤
│ 説明                                │
│ ・加算はXOR演算 (a + b = a ^ b)   │
│ ・既約多項式: x³² + x¹⁸ + x² + x + 1│
└─────────────────────────────────────┘
```

## 実装詳細

### 7. リアルタイム多項式表示

- テキスト入力が変更されるたびに`takousiki()`を呼び出し
- 無効な入力の場合は「---」と表示
- eGuiの`ui.text_edit_singleline()`で入力を監視

### 8. エラーハンドリング

| エラー | メッセージ |
|--------|-----------|
| 0の逆元 | 「0には逆元が存在しません」 |
| 範囲外の値 | 「0～4294967295の範囲で入力してください」 |
| 非数値 | 「数値を入力してください」 |

### 9. 日本語UI

**ラベル:**
- 「入力A」「入力B」「結果」

**ボタン:**
- 「加算 (A + B)」
- 「乗算 (A × B)」
- 「逆元を計算」
- 「クリア」

**セクション見出し:**
- 「有限体GF(2³²)での演算」
- 「逆元計算」
- 「説明」

**補足説明:**
- 「※ 加算はXOR演算です」

### 10. eGuiの主な使用機能

| 機能 | 用途 |
|------|------|
| `ui.horizontal()` | 横並び配置（加算・乗算ボタンを並べる） |
| `ui.vertical()` | 縦並び配置 |
| `ui.text_edit_singleline()` | 入力欄 |
| `ui.button()` | ボタン |
| `ui.label()` | ラベル表示 |
| `ui.monospace()` | 多項式表示（等幅フォント） |
| `ui.separator()` | セクション区切り |
| `ui.heading()` | 見出し |
| `ui.group()` | グループ化（セクションを視覚的に分ける） |

### 11. 状態管理の流れ

1. ユーザーが入力 → `input_a`、`input_b`等の文字列を更新
2. 入力変更を検知 → `takousiki()`で多項式文字列を生成・表示
3. ボタンクリック → 演算実行（加算/乗算/逆元）
4. 結果を`result`に保存 → `takousiki()`で多項式表記を生成
5. 結果表示 → 10進数と多項式表記を両方表示

## 実装手順

1. `Cargo.toml`に`eframe`と`egui`を追加
2. `field32.rs`に`add`関数を追加（シンプルなXOR演算）
3. `lib.rs`でモジュールを公開
4. `gui.rs`で状態管理とUI構築
5. `main.rs`でアプリ起動

## 期待される成果

- 初学者でも理解しやすい、シンプルで教育的な電卓GUI
- 入力値の多項式表記をリアルタイムで確認できる
- GF(2^32)の加算・乗算・逆元の3つの主要機能を提供
- 日本語で分かりやすいインターフェース
